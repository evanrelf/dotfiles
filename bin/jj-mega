#!/usr/bin/env cargo +nightly -Zscript --quiet

---
[package]
edition = "2024"

[dependencies]
anyhow = "1.0.100"
clap = { version = "4.5.53", features = ["derive"] }
---

use clap::Parser as _;
use std::process::ExitCode;

#[derive(clap::Parser)]
#[command(disable_help_subcommand = true)]
struct Args {
    #[command(subcommand)]
    command: Command,
}

#[derive(clap::Subcommand)]
enum Command {
    Set {
        #[arg(value_name = "REVSET", required = true)]
        parents: Vec<String>,
    },
    Union {
        #[arg(value_name = "REVSET")]
        parents: String,
    },
    Difference {
        #[arg(value_name = "REVSET")]
        parents: String,
    },
    Rebase {
        #[arg(value_name = "REVSET", default_value_t = String::from("trunk()"))]
        base: String,
    },
}

fn main() -> anyhow::Result<ExitCode> {
    let args = Args::parse();

    let exit_code = match args.command {
        Command::Set { parents } => run_set(&parents)?,
        Command::Union { parents } => run_union(&parents)?,
        Command::Difference { parents } => run_difference(&parents)?,
        Command::Rebase { base } => run_rebase(&base)?,
    };

    Ok(exit_code)
}

fn run_set(parents: &[String]) -> anyhow::Result<ExitCode> {
    todo!()
}

fn run_union(parents: &str) -> anyhow::Result<ExitCode> {
    todo!()
}

fn run_difference(parents: &str) -> anyhow::Result<ExitCode> {
    todo!()
}

fn run_rebase(base: &str) -> anyhow::Result<ExitCode> {
    todo!()
}
